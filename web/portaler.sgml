<chapter id="portaler">
<title>Administration af web-indhold</title>

<para>
Der er flere muligheder for at lave web-portaler med Linux,
dvs. systemer som hjælper med at få en infrastruktur op omkring det
indhold, man selv skal levere. phpNuke er en mulighed, Zope en anden
og der er flere andre.
</para>


<sect1 id="zope">
<title>Zope</title>
<para>
Zope er et Open Source <emphasis>Content Management System</emphasis>.
Det bruges til - på en let og overskuelig måde - at opbygge et
website. Zope har sit eget komplekse adgangshieraki, som gør det
overskueligt at lave diverse services på sit site som kun en udvalgt
skare har adgang til.  Zope er bygget op over forskellige
<emphasis>Products</emphasis> som man kan importere ind i sin
Zope. Disse produkter varierer lige fra forskellige databaseforbindelser
til chats, gæstebøger og kalendere. Alt sammen noget du
kan bruge på dit site.  Zope er skrevet i Python. Internt bruges
markup-sproget DTML som man kan bruge til at manipulere dynamiske data
med på forskellige måder. Man kan dog også lave sine egne python
scripts hvis man hellere vil dette. De implementeres lige så let som
DTML dokumenter.  Zope har en indbygget webserver (ZServer) som man
kan "nøjes" med at bruge hvis man ikke bruger f.eks. Apache til
noget. Skal den køre parallelt med Apache skal der tilføjes lidt til
httpd.conf men det kan sagtens lade sig gøre.  Hvis du vil vide mere
om Zope, henvises til <ulink
url="http://www.zope.org">http://www.zope.org</ulink>.
</para>

<para>
En af Zope's største styrker er produktet CMF
(Content Management Framework). Dette kan bl.a. bruges til at bygge en
portal. Med CMF er det nemt at styre brugere. CMF sørger for at holde
indhold, data og kode adskilt. Har en indbygget skin-funktionalitet
som man kan bruge til at lave forskellige skins til sit site, lave sit
site flersproget osv. Læs mere på <ulink
url="http://cmf.zope.org">http://cmf.zope.org</ulink>
</para>

<sect2 id="zope-installation">
<title>Installation af Zope</title>
<para>
Start med at hente tar.gz filen fra <ulink
url="http://www.zope.org">http://www.zope.org</ulink>. Følgende skal
udføres som root: Udpak tarball'en i
<filename>/usr/local</filename>. Skift katalog til Zope-xx/ (xx er
versionsnummeret på Zope).  Kør filen: <command>./install</command>,
(denne skulle gerne være eksekverbar - ellers gør det med en
<command>chmod +x install</command>).  Nu oversættes et start og et
stop script til Zope.  Der vil også blive vist et admin password -
skriv dette ned!  Den basale Zope er nu installeret!
</para>

<FIGURE ID="zope-fig" FLOAT="1">
<TITLE>Zope i aktion</TITLE>
<GRAPHIC FILEREF="zope.&magic;"  SCALE="40"></GRAPHIC>
</FIGURE>
</sect2>

<sect2 id="zope-mysql">
<title>Zope koblet til MySQL</title>
<para>
Lad os nu se på hvordan Zope kobles til MySQL.
</para>

<sect3 id="zope-mysql-data">
<title>Få Zope til at bruge MySQL i stedet for Zope's egen Z Gadfly database</title>

<para>
Zope har sin egen indbyggede databasei (Z Gadfly), og er dit behov for datalagring
ikke særlig stort, kan du sagtens "nøjes" med denne. Den har dog en
øvre negrænsning på et par gigabyte. Eftersom der gemmes en del i
denne database i forvejen (bl.a. brugerdata) er dette nok ikke den
optimale løsning hvis du skal lave et stort site med mange brugere. Så
er der lavet forskellige adaptorere til de mest brugte databaser. Til
MySQL findes produktet ZMySQLDA. Dette hentes på <ulink
url="http://www.zope.org/Products/Members/MikeP/ZMySQLDA">http://www.zope.org/Products/Members/MikeP/ZMySQLDA</ulink>. Produktet
kræver at du har MySQL-misc, MySQL-devel og MySQL-python installeret
(alle disse kan hentes fra <ulink
url="http://www.mysql.com/download/">http://www.mysql.com/download/</ulink>).
Udpak tarball'en i dit Zope-dir og skift katalog til til
<filename>lib/python/Products/ZMySQLDA/src</filename>. Nu skal du
kompilere en extension så python kan connecte til MySQL. Skriv:
</para>

<screen>
make -f Makefile.pre.in boot 
make
</screen>

<para>
Test at modulet virker i python ved at starty python (dette gøres med
kommandoen "python") og skriv: <command>import MySQL</command>. Får du
ingen fejl, virker modulet. Til slut skal du bare kopiere
<filename>MySQLmodule.so</filename> et katalog-niveau op (i dit <filename>ZMySQLDA</filename>-katalog) og genstarte din Zope.
Du kan også finde adaptere til PostgreSQL, Oracle, MS SQL etc.
</para>

<para>
Har du problemer med at få MySQL-modulet til at virke, kan du søge hjælp
på Zope's mailingliste (<ulink url="http://www.zope.org/Resources/MailingLists">http://www.zope.org/Resources/MailingLists</ulink>).
</para>

</sect3>

<sect3 id="zope-mysql-vis">
<title>Vise MySQL data i Zope</title>
<para>
Sådan henter du data fra f.eks. en MySQL database og viser dem.  Dette
gøres ret enkelt i Zope. Gå ned i din rodfolder og tilføj et "Z MySQL
Database Connection"-objekt. Udfyld formen med de rette de data og
tilføj den. Tilføj nu en ZSQL Method. "Arguments"-feltet udfylder du
med udvælgelseskriterier til query-strengen. Hvis du nu har en tabel i
din database der hedder Medarbejdere.  Den har følgende kolonner:
Navn, Afdeling, Alder. Du vil gerne liste alle medarbejdere der er
født i 1980. Fra det DTML-Document der kalder din ZSQL Method har du
adgang til variablen alder. Derfor kan du i din "Argument"-liste
skrive alder. Din query-streng skal så se ud som følger:
<literal>SELECT * FROM Medarbejdere WHERE ALDER=&lt;dtml-sqlvar alder
type=string&gt;</literal>.
</para>

<para>
Fra dit DTML Document kalder du din ZSQL Method på følgende måde:
</para>

<screen>
&lt;dtml-in expr="MinSQLMethod(alder=alder)"&gt;
        Navn: &lt;dtml-var Navn&gt;&lt;BR&gt;
        Afdeling: &lt;dtml-var Afdeling&gt;&lt;BR&gt;&lt;BR&gt;
&lt;/dtml-in&gt;
</screen>

<para>
Forklaring: &lt;dtml-in&gt; er en nem måde at iterere gennem
f.eks. SQL resultater. Den fungerer på samme måde som f.eks. en
for-løkke i PHP.  For at være sikker på at alder optræder i
REQUEST-objektet, kalder man sin ZSQL-Method med alder-variablen.
&lt;dtml-var&gt;-tagsene indsætter variablerne der returneres fra
ZSQL-metoden.
</para>

<FIGURE ID="zope-addcon-fig" FLOAT="1">
<TITLE>Tilføj MySQL forbindeler</TITLE>
<GRAPHIC FILEREF="add_con.&magic;"  SCALE="60"></GRAPHIC>
</FIGURE>

<FIGURE ID="zope-addsql-fig" FLOAT="1">
<TITLE>Tilgang til MySQL</TITLE>
<GRAPHIC FILEREF="add_sql.&magic;"  SCALE="60"></GRAPHIC>
</FIGURE>

</sect3>

<sect3 id="andre-zope">
<title>Andre Zope-produkter</title>
<para>
Som tidligere nævnt findes der mange forskellige produkter til Zope,
som er udviklet af andre Zope-brugere. Det smarte ved at bruge disse
produkter er at i stedet for selv at lave f.eks. en chat, kan man
hente en fra <ulink url="http://www.zope.org/Products">http://www.zope.org/Products</ulink>.
</para>

<para>
Det er ret nemt at installere disse produkter. Der findes to måder de
fleste produkter installeres på. (Andre måder kan forekomme - læs
derfor altid installations vejledningen). Filer er som regel pakket
som tar.gz, eller også har den en <filename>.zexp</filename>
extension. I det første tilfælde skal filen udpakkes så det pakkede
dir ender med at ligge i
<filename>/usr/local/Zope-xx/lib/python/Products/</filename>.
Herefter genstartes Zope og dit nye produkt er klar til brug. Ender
filen derimod på <filename>.zexp</filename> skal filen ligges i
<filename>/usr/local/Zope-xx/import</filename>. Du skal så gå ind i
Zope's administration interface i Control Panel - Products og klikke
på "import/export"-knappen. En ny side kommer nu frem. I
"import"-tekstfeltet skriver du navnet på den fil du netop har
placeret i import-dir'et og klikker på "import"-knappen. Produktet vil
nu være synligt i listen over produkter (Control Panel - Products).
</para>

<para>
Du bruger produkterne ved at tilføje dem i de relevante mapper i dit
administrations interface.
</para>
</sect3>
</sect2>


<sect2 id="CMF">
<title>CMF</title>
<para>
CMF er et meget kraftfuldt værktøj som man kan udvide sin Zope med.
CMF står for Content Mangement Framework og bruges til at opbygge - på
en meget nem måde - portaler med. CMF benytter sig også af Zope's
rolle hieraki. Derudover bliver man introduceret for "skins".
Zope.org har dedikeret et helt site til deres portal-produkt. Adressen
er <ulink url="http://cmf.zope.org">http://cmf.zope.org</ulink>. 
Det er her du how-to's, nye portal-produkter,
nyheder og hvad der ellers er værd at vide om CMF.
</para>

<sect3 id="CMF-installation">
<title>Sådan installeres CMF</title>

<para>
Gå ind på Zope's CMF-site. På den første side er der et link til deres
download-side. Hent den af versionerne der hedder 1.0 og ikke er alpha
eller beta. Din tarball skal nu udpakkes i
<filename>&lt;Zopedir&gt;/lib/python/Products</filename>. Du får lavet
en folder der hedder CMF1.0. Gå ned i det og flyt de tre biblioteker
der er dernede et level op. Der skulle nu i din Products folder ligge
3 nye foldere: CMFCore, CMDDecor, CMFDefault. Genstart din Zope og CMF
er klar til brug !
</para>
</sect3>


<sect3 id="CMF-igang">
<title>Kom godt igang med CMF</title>

<para>
For at kunne lave sin portal, skal man gå ind i Zope's
administrationsinterface. I den folder du gerne vil placere din portal
(som regel rod-folderen) vælger du at tilføje et CMF Site. Du kalder
din portal noget passende og portalen er nu klar til brug. For at
komme igang med at bruge din portal, skal du klikke på
"View"-tabben. Der er et par ting der skal konfigures, før din portal
er klar til offentligheden. Du kan enten vælge at bruge portalen egen
konfigurationsside, eller du kan konfigurere den via
administrationssiden. Vælger du det sidste skal du gå tlbage til
<filename>http://www.mitdomæme.dk:8080/manage</filename> og vælge din
portal. Herefter skal du klikke på "Properties"-tabben. Indtast eller
udskift de eksisterende værdier og klik på "Save". Nu er portalen klar
til at se dagens lys :-)
</para>

<para>
Der er masser af måde du kan ændre designet af din portal på. Men
inden du går igang med det, er det måske en meget god idé at kigge
lidt på hvordan portalen hænger sammen. Der findes som standard tre
slags brugere; Anonymous, Member og Reviewer. Man er Anonymous indtil
man bliver medlem. Når man så er medlem, kan man bidrage med
forskellige ting til portalen. Prøv at opret en bruger ved at klikke
på "Join" og log ind. Du vil nu få nogle flere valgmuligheder i den
venstre menu. Hvis du klikker på "My Stuff" kommer indholdet af din
folder frem i vinduet. Du kan nu vælge enten at editere filen
"index_html" (som er den side andre kan se hvis din profil er listet)
eller du kan vælge at tilføje mere til folderen. Klik på "Add" og prøv
at tilføje en nyhed. Først udfylder du objektet's metadata og derefter
vælger du at editere teksten. Når du har gjort dette, vil du
selvfølgelig gerne have at andre skal kunne læse din nyhed, så du
klikker på "Publish". Din nyhed er dog ikke helt publiceret endnu. For
at den kan blive dette, er der en bruger med rollen "Reviewer" eller
"Manager" der skal godkende din nyhed. Du kan nu vælge enten at
oprette en anden bruger du kan tildele rollen "Reviewer" eller du kan
vælge at logge ind med din administrator bruger (som jo har rollen
"Manager"). Vælger du det første skal du logge ud, klikke endnu engang
på "Join", oprette brugeren og gå ind i administrationsinterfacet
(<filename>http://www.mitdomæne.dk:8080/minportal/manage</filename>). Her
skal du klikke på den folder dine medlemmer ligger i (acl_users) og
klikke på den bruger du gerne vil tildele rollen "Reviewer". Marker
"Reviewer" i select-boxen og klik på "Save". Gå nu tilbage til din
portal og log ind som denne review-bruger. Du vil nu se nederst i den
venstre menu at der står "Pending (1)". Klik her. Læs og godkend
nyheden så vil denne blive publiceret. Gå tilbage til portalens
forside og kig i højre side i nyheds-kassen. Nyheden optræder nu her.
På samme måde som du lige tilføjede en nyhed, kan alle dine
portal-brugere tilføje dokumenter, nyheder, billeder, links
etc. etc. Den eneste der begrænser dette, er portal-administratoren.
</para>
</sect3>

<sect3 id="CMF-portal">
<title>Lav portalen som du selv vil have den</title>
<para>
Det er nu på tide at kigge på de lidt mere konfigurér-bare ting af
portalen der ikke kræver den store programmør. Portalens udseende
bliver styret fra den folder der hedder "portal_skins". Gå tilbage til
administrations-interfacet og klik på "+" på skins-folderen så den
folder sig ud. Der ligger en masse folderen hvoraf en er en
"almindelig" folder. De andre er det der bliver kaldt for "FileSystem"
foldere. Indholdet i disse kan ikke ændres i denne folder, men kan
kopieres til den folder der hedder "Custom" og ændres her. Hvis du
klikker på folderens "Properties"-tab, kan du se hvordan de
forskellige skins er defineret. Ud for hvert enkelt skin, står navnene
på de foldere der bliver inkluderet i skin'et. Folderne bliver
gennemsøgt fra venstre mod højre. D.v.s. at hvis man kopiere en fil
fra f.eks. "generic"-folderen til "custom"-folderen, bliver den kopi
af filen der ligger i "custom" brugt før den der ligger i
"generic". Hvis man nu byttede om på rækkefølgen af "custom" og
"generic" ville den tilrettede kopi af filen ikke blive brugt. På
denne måde kan man definere forskellige former for skins (med
forskellige stylesheets f.eks.) til sin portal og dine brugere har nu
forskellige udseender at vælge imellem. Du kan også bruge skins til at
definere forskellige sprog med. En anden god ting man kan lave er et
"Printable" skin som gør det muligt at vise en print-venlig side af
alle dine dokumenter. Du laver bare en folder der hedder "Printable" i
"portal_skin" folderen, kopierer de mest nødvendige filer ned i (såsom
"index_html" etc.). Herefter laver du på "portal_skin"-folderens
properties side et nyt skin der hedder "Printable" og tilføjer de
skin-foldere der er nødvendige (som oftes skal de samme foldere
inkluderes som også er i de andre skins på nær dem der sætter farver
ind, laver topbaren, sidebarerne etc.). At tilrette de eksisterende
skins og lave nye er en hel videnskab for sig, men jo mere man
arbejder med det, jo bedre forståelse får man for hvordan det hænger
sammen.
</para>

<para>
Der er efterhånden blevet udviklet flere og flere portal-typer end dem
din portal blev født med. Disse finder du på <ulink
url="http://cmf.zope.org">http://cmf.zope.org</ulink>. Det er ikke
helt let at tilføje nye portal-typer til portalen, da der er mange
forskellige måder man kan gøre det på. Men som regel har udvikleren af
portal-typen lavet en installationsvejledning og så er det bare med at
følge den.
</para>

<para>
Løber du ind i problemer du ikke umiddelbart kan løse selv, er der
hjælp at hente. Du kan tilmelde dig mailinglisten Zope-CMF. Klik ind
på <ulink url="http://www.zope.org/Resources/MailingLists">http://www.zope.org/Resources/MailingLists</ulink>
og tilmeld dig denne liste. Så er du i hvert fald godt på vej !
</para>
</sect3>
</sect2>

</sect1>

<!--
<sect1 id="phpnuke">
<title>phpNuke</title>

<para>
Se <ulink
url="http://www.phpnuke.org">http://www.phpnuke.org</ulink>. More to follow.
</para>
</sect1>
-->
</chapter>
