<chapter id="cdrombraending">
<title>Opsætning af cd-brænder under Linux</title>
<indexterm><primary>Brænde cdrom</primary></indexterm>
<indexterm><primary>cdrom</primary><secondary>brænde</secondary></indexterm>

<para>
Er man så heldig at man har en scsi brænder, så skulle man bare kunne
installere X-CD-roast og få det til at virke direkte. Har man en brænder
af ide/atapi-typen, så er man nødt til at lave en ide-scsi-emuluering
for at få dette til at virke. Det er dog ikke så svært som det lyder
og fungerer fint. Det første kræver at kernen skal bygges til at
have ide-scsi, scsi cdrom, generic scsi og ide-cd bygget support på
den ene eller den anden måde. I dag er de fleste standard
distributioner sat op og forberedt på dette. Derfor skal der blot
loades nogle moduler for at det hele virker. Disse skal findes med:
</para>

<screen>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>uname -r</USERINPUT>
</screen>

<para>
Dette giver den kerne version man i øjeblikket kører på, så kan man se
hvilket katalog i <filename>/lib/modules</filename>, der er
interessant. For Mandrake 7.2 vil dette f.eks. være
2.2.17-21mdk. Dette anvendes i det følgende:
</para>

<screen>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>cd /lib/modules/2.2.17-21mdk; ls </USERINPUT>
alsa/   fs/    modules.dep             modules.parportmap  net/     usb/
block/  ipv4/  modules.generic_string  modules.pcimap      pcmcia/
cdrom/  misc/  modules.isapnpmap       modules.usbmap      scsi/
</screen>

<para>
Her er det kataloget <filename>scsi</filename>, der er interessant. Se
efter om følgende filer eksisterer:
</para>

<screen>
scsi/sg.o
scsi/ide-scsi.o
</screen>

<para>
Hvis ja, så er kernen allerede klar til scsi emuleringen.  Eksisterer
de ikke så skal kernen omkonfigureres, se <xref linkend="kernelcompile">.  
Det man skal være opmærksom på under kerne-oversættelsen
er menupunkterne under "SCSI med SCSI generic" og "SCSI
cdrom" er med som enten modul eller bygget helt ind i kernen og
menupunkterne under "Block Devices med SCSI-emulation" og "IDE/ATAPI
cdrom"-support er med som enten modul eller bygget ind i kernen.
</para>

<para>
Vælges de som modul så skal der køres en <command>modprobe</command>
på modulnavnet når systemet kommer op for at loade modulerne, bygges
de ind i kernen virker de bare. Når dette er gjort kan man bare
fortsætte her.  Så skal der lige laves en lille ændring først. I
<filename>/etc/lilo.conf</filename> skal der laves følgende ændring
(se linien med append).
</para>
<indexterm><primary>LILO</primary><secondary>append ekstra device</secondary></indexterm>

<screen>
boot=/dev/hda
map=/boot/map
install=/boot/boot.b
prompt
lba32
timeout=50
append="hdb=ide-scsi" 
image=/boot/vmlinuz-2.2.5-15
        label=linux
        root=/dev/hda5
        read-only
</screen>

<para>
I linien append skal skrives hvilken enhed brænderen er på
ide-controlleren (f.eks. hdb = primær slave-enhed). Bagefter køres
<command>/sbin/lilo</command> og der skal ekseptionelt rebootes. Når
systemet kommer op igen kan man nu skrive
</para>

<indexterm><primary>modprobe</primary><secondary>cdrom</secondary></indexterm>
<indexterm><primary>cdrom</primary><secondary>modprobe</secondary></indexterm>

<screen>
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>/sbin/modprobe sg</USERINPUT>
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>/sbin/modprobe ide-scsi</USERINPUT>
</screen>

<para>
Så skulle scsi emulueringen være i orden og man kan nu køre:
</para>

<screen>
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>cat /proc/scsi/scsi</USERINPUT> 
Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: HP       Model: CD-Writer+ 7200  Rev: 3.01
  Type:   CD-ROM                           ANSI SCSI revision: 02
</screen>

<para>
Og der skal brænderen være dukket op. Så er det bare at installere
brændersoftware, så kan du brænde din første Linux-cdrom til dine venner.
</para>

<para>
Skal man nu automatisere dette lidt så man ikke skal skrive
<command>modprobe</command>-linierne efter hver genstart af maskinen,
så skal de tilføjes i systemets opstarts-script som på min Red Hat er
<filename>/etc/rc.d/rc.local</filename>, hvor man kan tilføje
linierne.
</para>

<para> 
For nu at kunne bruge det drev der er lavet scsi-emulering på
som almindeligt cdrom-drev også skal der lige laves en lille
ændring. Fløgende symlink er sandsynligvis sat.
</para>

<screen>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>ls -l /dev/cdrom</USERINPUT>
lrwxrwxrwx    1 root     root            4 Dec 30 22:03 /dev/cdrom -> hdb
</screen>

<para> 
Eftersom der nu er lavet en scsi emulering så eksisterer cd
drevet ikke længere på ide bussen på systemet men på den emulerede
scsi bus derfor har den også fået et nyt device dette er
<filename>/dev/scd0</filename> (lidt afhængigt af om der er andre
scsi enheder i systemet) derfor skal dette symlink også ændres til at
pege det korrekte sted hen.
</para>

<screen>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>rm /dev/cdrom</USERINPUT>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>ln -s /dev/scd0 /dev/cdrom</USERINPUT>
<PROMPT>[root@linus /root]#</PROMPT> <USERINPUT>ls -l /dev/cdrom</USERINPUT>
lrwxrwxrwx  1 root root 4 Dec 30 22:03 /dev/cdrom -> /dev/scd0
</screen>

<sect1 id="X-cdroast">
<title>X-CD-roast</title>
<indexterm><primary>X-CD-roast</primary></indexterm>
<indexterm><primary>cdrom</primary><secondary>brændeprogram, X-CD-roast</secondary></indexterm>

<para>
På <ulink
url="http://www.xcdroast.org">http://www.xcdroast.org</ulink> kan du
fine X-CD-roast. Få fat i den og installér den. Skal man kunne brænde
cdrommer uden at være root bliver man nødt til at sætte suid-bitten på
<filename>xcdroast</filename>, dette gøres:
</para>

<screen>
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>which xcdroast</USERINPUT>
/usr/local/bin/xcdroast
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>chmod +s /usr/local/bin/xcdroast</USERINPUT>
</screen>

<para>
Så skulle det være i orden. Derefter startes
<command>xcdroast</command> hvorefter man lige skal svare på en
en ret morsom "disclaimer".
</para>


<FIGURE ID="xcdroast1-fig" FLOAT="1">
<TITLE>X-CD-roast</TITLE>
<GRAPHIC FILEREF="xcdroast1.&magic;"  SCALE="50"></GRAPHIC>
</FIGURE>

<para>
Det antages nu at cdrom brænderen er sat op til at virke, dette testes
med "Setup".  Under "CD Setup" vælges brænderen som cd-writer-device,
og speed sættes. Eksisterer brænderen ikke under dette punkt, så
skyldes det, at brænderen enten ikke er tilsluttet ordentligt (scsi)
eller at det er en ide-brænder som kræver en
ide-scsi-emuluering. Dette ses i sidste afsnit.  Under "HD Setup"
vælges et image-mount-point (der hvor du monterer dit image).  Her kan
man vælge, hvis man har en hel partition dedikeret til cd-images eller
lignende at den skal bruge dette. Det er meget praktisk at der mindst
er plads til en enkelt hel cd på den valgte placering. Det er på denne
plads i filsystemet at xcdroast lægger de rippede images.  Under
"Misc" og "Defaults", kan sættes ting som lyd, vindues-placering,
etc. Disse er dog ikke vigtige for brændingen. Derefter vælges "Save"
og "Done". Nu skulle de øvrige knapper ikke være grå længere, men alle
skulle kunne bruges.  Så afhænger det af hvad man skal brænde. Under
"Copy Data CD" ligger alle de operationer man skal kunne bruge på en
hel cd.
</para>

<FIGURE ID="xcdroast2-fig" FLOAT="1">
<TITLE>X-CD-roast</TITLE>
<GRAPHIC FILEREF="xcdroast2.&magic;"  SCALE="50"></GRAPHIC>
</FIGURE>

<FIGURE ID="xcdroast0-fig" FLOAT="1">
<TITLE>X-CD-roast</TITLE>
<GRAPHIC FILEREF="xcdroast0.&magic;"  SCALE="50"></GRAPHIC>
</FIGURE>

<para>
Det skal lige bemærkes at xcdroast bruger <filename>.raw</filename> i
stedet for <filename>.iso</filename> som endelse. Dette ligger kun i
navnet, ikke andet, skal man derfor bruge det rippede image til noget
hvor denne endelse er vigtig, kan man bare lave en symlink med det
andet navn. De rippede (eller andre) images skal dog have endelse
<filename>.raw</filename> for at xcdroast vil kendes ved dem. Der er
heller ikke noget krav til at de faktisk skal ligge i
<filename>/image</filename> kataloget:
</para>

<screen>
<PROMPT>[root@linus /root]# </PROMPT><USERINPUT>ls -l</USERINPUT>
total 1
lrwxrwxrwx 1 root root   38 Jun 14 20:32 Mandrake-7.1-ext.raw -> /home/ftp/pub/iso/Mandrake-7.1-ext.iso
lrwxrwxrwx 1 root root   39 Jun 14 19:32 Mandrake-7.1inst.raw -> /home/ftp/pub/iso/Mandrake-7.1-inst.iso
lrwxrwxrwx 1 root root   32 Apr  3 19:19 Redhat61.raw -> /home/ftp/pub/iso/RedHat-6.1.iso
lrwxrwxrwx 1 root root   32 Apr  3 19:19 Redhat62.raw -> /home/ftp/pub/iso/RedHat-6.2.iso
drwxr-xr-x 2 root root 1024 Feb 29 20:26 tmp
</screen>

<para>
Under "Copy Audio CD" er der samme features som ved data, dette virker
bare på audio cd´er i stedet:
</para>

<FIGURE ID="xcdroast3" FLOAT="1">
<TITLE>X-CD-roast</TITLE>
<GRAPHIC FILEREF="xcdroast3.&magic;"  SCALE="50"></GRAPHIC>
</FIGURE>

<para>
Skal man nu selv til at lægge et filsystem ud på cd, så er det punktet
"Master CD", man skal vælge. Under Master from/to, kan man nu vælge
den del af filsystemet man ønsker at brænde ud. Følgende valg vil lave
et master image med <filename>/home</filename> på hvor
<filename>/home/ftp</filename> ikke er på.
</para>


<FIGURE ID="xcdroast4" FLOAT="1">
<TITLE>X-CD-roast</TITLE>
<GRAPHIC FILEREF="xcdroast4.&magic;"  SCALE="50"></GRAPHIC>
</FIGURE>

<para>
Så bliver vi nødt til at vælge "Master Image", hvor vi kan danne et
image af det, vi gerne vil brænde ud, så brænder vi bare det under
"Write image".
</para>

<para>
Mere om X-CD-roast og opsætning af brænder
<filename>/usr/local/xcdroast-0.96ex/README*</filename> eller hvor du
nu ellers installerede <command>xcdroast</command>.
</para>
</sect1>

<sect1 id="cdrecord">
<title>Brænde cdrom med cdrecord</title>
<!-- Skrevet af Gert Holtoft <holtoft@get2net.dk> -->
<indexterm><primary>cdrecord</primary></indexterm>
<indexterm><primary>cdrom</primary><secondary>brændeprogram, cdrecord</secondary></indexterm>

<para>
I dette afsnit findes en mini-HOWTO på dansk til CD-R og CD-RW, 
i bund og grund kun en oversættelse og 'nedkogning' af
CD-Writing-HOWTO til det mest elementære.
</para>

<para>
Du skal starte med at installere følgende pakker:
<filename>cdrecord-*.rpm</filename>,
<filename>cdparanoia-III*.rpm</filename> og
<filename>mkisofs-*</filename>.
</para>

<para>
Vi forudsætter at brænderen er sat op og virker, dog kører vi lige en
<command>cdrecord -scanbus</command>. Husk at loade brænder-modulerne,
hvis det ikke er gjort.  I denne opsætning ser den således ud:
</para>

<screen>
	Using libscg version 'schily-0.1'
Cdrecord release 1.8a29 Copyright (C) 1995-1999 Jörg Schilling
scsibus0:
	0,0,0	  0) 'HP      ' 'CD-Writer+ 8100 ' '1.0g' Removable CD-ROM
	0,1,0	  1) *
	0,2,0	  2) *
	0,3,0	  3) *
	0,4,0	  4) *
	0,5,0	  5) *
	0,6,0	  6) *
	0,7,0	  7) *
</screen>

<para>
Det vil sige at vores cdrom-brænder-device i dette tilfælde 
er: <filename>dev=0,0,0</filename>
</para>

<sect2 id="cdrom-skrivning">
<title>Skrivning og brænding af et data image</title>

<para>
Læg alle libs og filer i et bibliotek (eks. <filename>/test</filename>)
Vedtag et navn for dit cd image (eks. <filename>mit_stof</filename>).
</para>

<para>
Lav dit cdrom-image med <command>mkisofs</command>:
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>mkisofs  -r  -o  mit_stof  /test/</USERINPUT>
</screen>


<para>
Ønskes et mere Windows-venligt image, brug -J option ( Joliet )
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>mkisofs  -r  -J  -o  mit_stof /test/</USERINPUT>
</screen>

<para>
Test indholdet med følgende kommando:
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>mount -t iso9660 -o ro,loop=/dev/loop0  mit_stof /mnt</USERINPUT>
</screen>

<para>
I <filename>/mnt</filename> kan indholdet checkes, afmonter dernæst
med kommandoen <command>umount mit_stof /mnt</command>.
</para>
</sect2>

<sect2 id="braende-cdrom">
<title>Cdrom brændes</title>
	
<para>
Du kan nu brænde din cdrom med
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v speed=2 dev=0,0,0 -data mit_stof</USERINPUT>
</screen>


<para>
En langt mere interssant metode er at oprette en fil på 650/700 MB
(alt efter mediestørrelse), som så fyldes med diverse ting og sager og
derefter brændes som et iso-image.
</para>

<para>
Oprettelse af filen  test.iso
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>dd if=/dev/zero of="test.iso" bs=1024k count=650/700</USERINPUT>
</screen>

<para>
Opret et ext2 filsystem på denne fil	
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>/sbin/mke2fs -b 2048 test.iso</USERINPUT>
</screen>

<para>
Til spørgsmålet "test.iso is not a block device", skal du bare sige
"y" for "yes - proceed anyway".
</para>

<para>
Montér filen med:	
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>mount -t ext2 -o loop=/dev/loop1 test.iso /mnt</USERINPUT>
</screen>
	
<para>
Kopier hvad du har lyst til, til <filename>/mnt</filename> og afmonter
den med kommandoen <command>umount test.iso /mnt</command>.
</para>


<para>
Vi kan nu brænde vores cdrom med:
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v speed=2 dev=0,0,0 -data test.iso </USERINPUT>
</screen>


<para>
Det er jo dejligt at kunne redigere frit i et "iso-image" der jo kun
er "read only". Den sidste gode ting med data-medier er direkte og rå
kopiering fra cdrom (her <filename>/dev/hdb</filename>) til brænder. 
Kommandoen er:
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v dev=0,0 speed=2 -isosize /dev/hdb</USERINPUT>
</screen>



<para>
Skulle kildemediet være større end modtagermediet, kommer der automatisk en
fejlmelding fra cdrecord, og der bliver ikke brændt noget.
Denne detalje virker ikke med en musik-cd.
</para>

<indexterm><primary>cdrom</primary><secondary>brændeprogram, cdparanoia</secondary></indexterm>
<indexterm><primary>musik-cd</primary><secondary>cdparanoia</secondary></indexterm>

<para>
Til at brænde en musik-cd kommer nu en helt basal opskrift.
Optage en cd (eller dele af den), gøres med <command>cdparanoia</command>:
Læg din originale musik-cd i cdrom drevet og kør så følgende for at
rippe alle sange til filerne <filename>track01.cdda.wav</filename>, <filename>track02.cdda.wav</filename> osv.
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdparanioa -B "1-"</USERINPUT>
</screen>

<para>
Ønsker du kun at overføre numrene tre til fem, skal du køre
<command>cdparanoia -B "3-5"</command>.
</para>

<para>
Du kan nu brænde din musik-cd med
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v speed=2 dev=0,0,0 -audio track01.cdda.wav track02.cdda.wav ...</USERINPUT>
</screen>

<para>
hvor ... naturligvis betyder at du fortsætter med at angive musik-filnavne.
Du kan også bruge * (alle filer), hvis du har filerne i et katalog:
<command>cdrecord -v speed=2 dev=0,0,0 -audio *.cdda.wav</command>
</para>

<para>
Omkring audio-formater se <command>man cdparanoia</command>, kig evt på
<command>Sox</command> eller <command>ecasound</command>.
</para>

<para>Sox kan du finde mere om på <ulink url="ftp://sunsite.unc.edu/pub/Linux/apps/sound/convert/sox-11gamma-cb3.tar.gz">ftp://sunsite.unc.edu/pub/Linux/apps/sound/convert/sox-11gamma-cb3.tar.gz</ulink>.
Men se om den ikke også er med i din Linux-distribution.
</para>

<para>
Ecasound har hjemmesiden <ulink url="http://www.wakkanet.fi/ecasound">http://www.wakkanet.fi/ecasound</ulink>.
</para>

<para>
Blandede skiver, dvs. både data og audio på samme medie, kan du også lave
ved at kombinere <command>-data</command> og <command>-audio</command>.
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v speed=2 dev=0,0,0 -data mit_stof -audio track01.cdda.wav</USERINPUT>
</screen>

<para>
Vedrørende CD-RW-medier er proceduren den samme, blot skal man
huske at "blanke" mediet inden det bruges næste gang:
</para>

<screen>
<PROMPT>[root@linus /test]#</PROMPT> <USERINPUT>cdrecord -v speed=2 dev=0,0,0 blank=xxxx</USERINPUT>
</screen>

<para>
hvor <command>xxxx</command> udfyldes ud fra dette:
</para>

<itemizedlist mark="bullet"  spacing="compact">
<listitem>
 <para>
  <emphasis>all</emphasis>             blank the entire disk
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>disc</emphasis>            blank the entire disk
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>disk</emphasis>            blank the entire disk
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>fast</emphasis>            minimally blank the entire disk (PMA, TOC, pregap)
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>minimal</emphasis>         minimally blank the entire disk (PMA, TOC, pregap)
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>track</emphasis>           blank a track
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>unreserve</emphasis>       unreserve a track
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>trtail</emphasis>          blank a track tail
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>unclose</emphasis>         unclose last session
 </para>
</listitem>
<listitem> 
 <para>
  <emphasis>session</emphasis>         blank last session    
 </para>
</listitem>
</itemizedlist>


<para>
For yderligere information læs:
<command>man cdrecord</command>, <command>man cdparanoia</command>,
<command>man mkisofs</command> og i øvrigt CD-Writing HOWTO.
</para>
</sect2>

</sect1> <!--cdrecord -->
</chapter>

