# Lokalt katalog (fuld sti)
locdirname:=$(shell pwd)

# Kort navn
targetshortname:=$(notdir $(locdirname))

# Med linuxbog- foran
targetname:=linuxbog-$(notdir $(locdirname))

# version
version:=$(shell grep -A2 "<listitem>" apprevhist.sgml | head -n 2 | tail -n 1 | cut -d' ' -f2 > version.sgml; cat version.sgml)

all: html pdf pakket_html pakket_sgml

html: stikord dato udgave
	echo '<!ENTITY magic "png">' > magic.sgml
	mkdir -p bog
	cp -p images/*.png bog/
	xmlto -o bog html bog.sgml
	tidy -mq bog/*.html || tidy -mq bog/*.html || true

pdf: stikord dato udgave
	echo '<!ENTITY magic "eps">' > magic.sgml
	mkdir -p pdf
	xmlto -o pdf pdf bog.sgml

pakket_html: html
	mkdir -p $(targetname)-$(version)-html
	cp -p bog/*.{html,png} $(targetname)-$(version)-html/
	tar czvf $(targetname)-$(version)-html.tar.gz $(targetname)-$(version)-html
	rm -rf $(targetname)-$(version)-html

pakket_sgml:
	mkdir -p $(targetname)-$(version)-sgml/images
	cp -p *.sgml $(targetname)-$(version)-sgml/
	cp -p images/*.png $(targetname)-$(version)-sgml/images/
	tar czvf $(targetname)-$(version)-sgml.tar.gz $(targetname)-$(version)-sgml
	rm -rf $(targetname)-$(version)-sgml

stikord:
	perl  ./collateindex.pl    -s Symboler -t Stikordsregister -g -i stikord    -o stikord.sgml -N

dato:
	date +%d/%m-%Y > dato.sgml

udgave:
	grep -A2 "<listitem>" apprevhist.sgml | head -n 2 | tail -n 1 | cut -d' ' -f2 > version.sgml

clean:
	rm -fr bog pdf
	rm -f  dato.sgml magic.sgml stikord.sgml version.sgml
	rm -f  $(targetname)-*-html.tar.gz

